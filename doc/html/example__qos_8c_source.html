<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/dpp/example_qos.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css" />
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">examples</a></li><li class="navelem"><a class="el" href="dir_3b907af6788adb4a007b7e829369d3f2.html">dpp</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">example_qos.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="example__qos_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*********************************************************************</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * (C) Copyright Broadcom Corporation 2013-2017</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *  you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *  See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *  limitations under the License.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> **********************************************************************</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * \file         example_qos.c</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * \brief        OpenNSL example application for QoS based on port</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * \details      In this example, we will map TC and DP from the packet PCP</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *               (targeted for tagged packet) including three modes:</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *               1. map dei without cfi for s tagged packet when use_de=0</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> *               2. map dei with cfi for s tagged packet when use_de=1</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *               3. map up to dp for c tagged packet</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *  use_de can be 0 or 1. 0 stands for not mapping dei without cfi; 1 stands for mapping dei with cfi.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *  Send Traffic from input port, say 2 and receive it on port 3 when use_de is 0:</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *  1. In port 2 vid 100 prio 0 cfi 0  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 1 cfi 1</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> *  2. In port 2 vid 100 prio 1 cfi 1  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 2 cfi 0</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> *  3. In port 2 vid 100 prio 2 cfi 0  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 3 cfi 1</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> *  4. In port 2 vid 100 prio 3 cfi 1  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 4 cfi 0</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> *  5. In port 2 vid 100 prio 4 cfi 0  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 5 cfi 1</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> *  6. In port 2 vid 100 prio 5 cfi 1  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 6 cfi 0</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> *  7. In port 2 vid 100 prio 6 cfi 0  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 7 cfi 1</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> *  8. In port 2 vid 100 prio 7 cfi 1  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 7 cfi 0</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> *  Send Traffic from port 2 and receive it on port 3 when use_de is 1:</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> *  1. In port 2 vid 100 prio 0 cfi 0  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 1 cfi 0</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> *  2. In port 2 vid 100 prio 1 cfi 1  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 2 cfi 1</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> *  3. In port 2 vid 100 prio 2 cfi 0  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 3 cfi 0</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> *  4. In port 2 vid 100 prio 3 cfi 1  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 4 cfi 1</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> *  5. In port 2 vid 100 prio 4 cfi 0  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 5 cfi 0</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> *  6. In port 2 vid 100 prio 5 cfi 1  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 6 cfi 1</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> *  7. In port 2 vid 100 prio 6 cfi 0  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 7 cfi 0</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> *  8. In port 2 vid 100 prio 7 cfi 1  &lt;-----CrossConnect-----&gt;  Out port 3 vid 300 prio 7 cfi 1</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> **********************************************************************/</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="init_8h.html">opennsl/init.h</a>&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="opennsl_2port_8h.html">opennsl/port.h</a>&gt;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="opennsl_2switch_8h.html">opennsl/switch.h</a>&gt;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="vswitch_8h.html">opennsl/vswitch.h</a>&gt;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="qos_8h.html">opennsl/qos.h</a>&gt;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="code" href="example__qos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">   65</a></span>&#160;<span class="keywordtype">char</span> <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="stringliteral">&quot;Syntax: example_qos                                                    \n\r&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="stringliteral">&quot;                                                                       \n\r&quot;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="stringliteral">&quot;Paramaters: None.                                                      \n\r&quot;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="stringliteral">&quot;                                                                       \n\r&quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="stringliteral">&quot;Example: The following command is used to map the TC and DP from the   \n\r&quot;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="stringliteral">&quot;         VLAN tagged packet, with tag ID 100.                          \n\r&quot;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="stringliteral">&quot;                                                                       \n\r&quot;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="stringliteral">&quot;         example_qos                                                   \n\r&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="stringliteral">&quot;                                                                       \n\r&quot;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="stringliteral">&quot;Usage Guidelines: None.                                                \n\r&quot;</span>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="code" href="example__qos_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">   77</a></span>&#160;<span class="preprocessor">#define DEFAULT_UNIT 0</span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a91668ed1245d073a2ac84e6121205d28">   78</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN 1</span></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a074e4c6c5b35a6e7df06fbc024b0760d">   79</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAC_DA        {0x00, 0x00, 0x00, 0x00, 0x00, 0x01}</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a523822b8d626fa4bcd6cfa36a6d8c0be">   81</a></span>&#160;<span class="preprocessor">#define MAC_MASK      {0xff, 0xff, 0xff, 0xff, 0xff, 0xff}</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a3dac63c8a5b5d1ccf667d0f7374ea64e">   84</a></span>&#160;<a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> <a class="code" href="example__qos_8c.html#a3dac63c8a5b5d1ccf667d0f7374ea64e">up_ovlan</a> = 100;</div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a5be88c338e62fa10f68b2344cc53b7d6">   85</a></span>&#160;<a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> <a class="code" href="example__qos_8c.html#a5be88c338e62fa10f68b2344cc53b7d6">down_ovlan1</a> = 200;</div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="code" href="example__qos_8c.html#aeea8641b678030d4ba20b5a9fc0ffef7">   86</a></span>&#160;<a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> <a class="code" href="example__qos_8c.html#aeea8641b678030d4ba20b5a9fc0ffef7">down_ovlan2</a> = 300;</div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a5e45f11b828c71c9c621bf12f9f0f37a">   87</a></span>&#160;<a class="code" href="structopennsl__vlan__port__s.html" title="Layer 2 Logical port type.">opennsl_vlan_port_t</a> <a class="code" href="example__qos_8c.html#a611a7708477876b54ecb88627aef9f5f">in_vlan_port1</a>, <a class="code" href="example__qos_8c.html#afa99e174a68c21a77440eed92a6296bb">in_vlan_port2</a>, <a class="code" href="example__qos_8c.html#aa308b122179ffb9bad17797b345d5e3c">out_vlan_port1</a>, <a class="code" href="example__qos_8c.html#a5e45f11b828c71c9c621bf12f9f0f37a">out_vlan_port2</a>;</div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a942336885851df0b2b58a1db305d6a6f">   88</a></span>&#160;<a class="code" href="structopennsl__vswitch__cross__connect__s.html" title="L3 tunneling initiator.">opennsl_vswitch_cross_connect_t</a> <a class="code" href="example__qos_8c.html#a942336885851df0b2b58a1db305d6a6f">gports_untag</a>, <a class="code" href="example__qos_8c.html#ae88ff94d5228fbb1a5a1da72580db706">gports_tag</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="code" href="example__qos_8c.html#aa44e37fccfd9234fdeebc48c560cfece">   89</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#aa44e37fccfd9234fdeebc48c560cfece">qos_eg_map_id_dft</a>[2];</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a8a19f7607d887deff271382fdd0d8e71">   91</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#a8a19f7607d887deff271382fdd0d8e71">pkt_pri</a>[8] = {0,1,2,3,4,5,6,7};</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="code" href="example__qos_8c.html#ae29cb3f7c20f2a4f97e347299de1eab3">   93</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#ae29cb3f7c20f2a4f97e347299de1eab3">pkt_cfi</a>[8] = {0,1,0,1,0,1,0,1};</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a11e9e0c74f0b7eced2c28d2dca952a57">   95</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#a11e9e0c74f0b7eced2c28d2dca952a57">internal_pri</a>[8] = {1,2,3,4,5,6,7,7};</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="code" href="example__qos_8c.html#ab1c7cd7429c646bc3b414c3f69b5a389">   97</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#ab1c7cd7429c646bc3b414c3f69b5a389">internal_color_stag_with_use_de</a>[8] = {0,1,0,1,0,1,0,1};</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a58b71ca8297fdc4e997e77d30b9902f5">   99</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#a58b71ca8297fdc4e997e77d30b9902f5">internal_color_stag_with_no_use_de</a>[8] = {1,0,1,0,1,0,1,0};</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="code" href="example__qos_8c.html#aae4f6180472805fc90a63703eb246474">  101</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#aae4f6180472805fc90a63703eb246474">internal_color_ctag</a>[8] = {0,0,0,0,1,1,1,1};           </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;         </div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72">  104</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72">service_type_e</a> {</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72aa4aff4db03ef735c22eda0d745ec1336">  105</a></span>&#160;    <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72aa4aff4db03ef735c22eda0d745ec1336">match_untag</a>,</div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72ac6b810c26f58e843de1254750b6840b8">  106</a></span>&#160;    <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72ac6b810c26f58e843de1254750b6840b8">match_otag</a></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;};</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a63e852d4088e913d25399c41e30daf5a">  110</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="example__qos_8c.html#a63e852d4088e913d25399c41e30daf5a">use_de_type_e</a> {</div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a63e852d4088e913d25399c41e30daf5aa276f1ff5c39c54d1253557d5fe141726">  111</a></span>&#160;    <a class="code" href="example__qos_8c.html#a63e852d4088e913d25399c41e30daf5aa276f1ff5c39c54d1253557d5fe141726">with_no_use_de</a>,</div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a63e852d4088e913d25399c41e30daf5aa403bab0af8dfbf8a2c156aa0ac7c86af">  112</a></span>&#160;    <a class="code" href="example__qos_8c.html#a63e852d4088e913d25399c41e30daf5aa403bab0af8dfbf8a2c156aa0ac7c86af">with_use_de</a></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;};</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">/* Map TC and DP from the packet PCP */</span> </div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="code" href="example__qos_8c.html#ae31c8867a38c33e793aff85a3c8a7627">  118</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#ae31c8867a38c33e793aff85a3c8a7627">qos_pcp_map_create</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>, <span class="keywordtype">int</span> is_use_de) </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;{</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordtype">int</span> color = 0;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordtype">int</span> mode = 0;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordtype">int</span> idx;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">/* set the mode of mapping pcp */</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  mode = <a class="code" href="group__port.html#ga15e47bbc2a1a16f6e068f9ed6390bb4e" title="Disable DSCP mapping.">OPENNSL_PORT_DSCP_MAP_NONE</a>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  rv = <a class="code" href="group__port.html#ga8f1dd711fff389d3843fbabb5e7ee2bc" title="Control mapping of Differentiated Services Code Points (DSCP).">opennsl_port_dscp_map_mode_set</a>(unit, -1, mode);    <span class="comment">/* global configuration, port has to be -1 */</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    printf(<span class="stringliteral">&quot;error in opennsl_port_dscp_map_mode_set() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">switch</span> (is_use_de) </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="example__qos_8c.html#a63e852d4088e913d25399c41e30daf5aa276f1ff5c39c54d1253557d5fe141726">with_no_use_de</a>:</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="comment">/* set the mode of mapping dei without cfi for s tagged pkt */</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      rv = <a class="code" href="group__switch.html#ga0a7f6e2ec0486325bf5359db5388febd" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_port_set</a>(unit, port, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33caee971ff69db06a1802c1c6d827a7847f" title="Choose color selection source.">opennslSwitchColorSelect</a>, <a class="code" href="group__switch.html#ga3b7b63e0ad3886328e4786012c0f1f0b" title="Priority-&gt;COLOR mapping.">OPENNSL_COLOR_PRIORITY</a>);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        printf(<span class="stringliteral">&quot;error in opennsl_switch_control_port_set() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="comment">/* set the mapping of TC and DP for tagged packet */</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; 8; idx++) </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      {               </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="comment">/* map tc and dp from PCP for tagged pkt */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        rv = <a class="code" href="group__port.html#ga15667a93ccb19b29d1e6509a5932e73e">opennsl_port_vlan_priority_map_set</a>(unit, port, <a class="code" href="example__qos_8c.html#a8a19f7607d887deff271382fdd0d8e71">pkt_pri</a>[idx], 0, <a class="code" href="example__qos_8c.html#a11e9e0c74f0b7eced2c28d2dca952a57">internal_pri</a>[idx], <a class="code" href="example__qos_8c.html#a58b71ca8297fdc4e997e77d30b9902f5">internal_color_stag_with_no_use_de</a>[idx]);   <span class="comment">/* cfi must be 0 because it isn&#39;t used */</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;          printf(<span class="stringliteral">&quot;error in opennsl_port_vlan_priority_map_set() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="example__qos_8c.html#a63e852d4088e913d25399c41e30daf5aa403bab0af8dfbf8a2c156aa0ac7c86af">with_use_de</a>:</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="comment">/* set the mapping of TC for tagged packet */</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; 8; idx++) </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      {              </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="comment">/* map tc from PCP for tagged packet*/</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        rv = <a class="code" href="group__port.html#ga15667a93ccb19b29d1e6509a5932e73e">opennsl_port_vlan_priority_map_set</a>(unit, port, <a class="code" href="example__qos_8c.html#a8a19f7607d887deff271382fdd0d8e71">pkt_pri</a>[idx], 0, <a class="code" href="example__qos_8c.html#a11e9e0c74f0b7eced2c28d2dca952a57">internal_pri</a>[idx], color); <span class="comment">/* cfi must be 0 because it isn&#39;t used */</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;          printf(<span class="stringliteral">&quot;error in opennsl_port_vlan_priority_map_set() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;          <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="comment">/* set the mode of mapping dei with cfi */</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        rv = <a class="code" href="group__switch.html#ga0a7f6e2ec0486325bf5359db5388febd" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_port_set</a>(unit,port,<a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33caee971ff69db06a1802c1c6d827a7847f" title="Choose color selection source.">opennslSwitchColorSelect</a>,<a class="code" href="group__switch.html#gaad5e07c5932512c1e8604a6274fd7bf8" title="SPVLAN CFI-&gt;COLOR mapping.">OPENNSL_COLOR_OUTER_CFI</a>);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          printf(<span class="stringliteral">&quot;error in opennsl_switch_control_port_set() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;          <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="comment">/* map dei with cfi for s tagged pkt */</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        rv = <a class="code" href="group__port.html#gae4bd3ff28640ca5b600e588d37a8a6ed" title="Set or retrieve color assignment for a given port and Canonical Format Indicator (CFI).">opennsl_port_cfi_color_set</a>(unit, -1, <a class="code" href="example__qos_8c.html#ae29cb3f7c20f2a4f97e347299de1eab3">pkt_cfi</a>[idx], <a class="code" href="example__qos_8c.html#ab1c7cd7429c646bc3b414c3f69b5a389">internal_color_stag_with_use_de</a>[idx]);  <span class="comment">/* global configuration, port has to be -1 */</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          printf(<span class="stringliteral">&quot;error in opennsl_port_cfi_color_set() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;          <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;    </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">/* map up to dp for c tagged pkt */</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">for</span> (idx = 0x0; idx &lt; 0x8; idx++) </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    rv = <a class="code" href="group__port.html#gabac44f58ca77a030e1eb930fc0c4d281" title="Set or retrieve color assignment for a given port and priority.">opennsl_port_priority_color_set</a>(unit, port, <a class="code" href="example__qos_8c.html#a8a19f7607d887deff271382fdd0d8e71">pkt_pri</a>[idx], <a class="code" href="example__qos_8c.html#aae4f6180472805fc90a63703eb246474">internal_color_ctag</a>[idx]);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      printf(<span class="stringliteral">&quot;error in opennsl_port_priority_color_set() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;} </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment"> * Create default l2 egress mapping profile.</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment"> * When adding or modifying a new VLAN tag, cos of the new tag is based on the default mapping profile.</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a82d05e2a85bb80929621fbb076d4487f">  209</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#a82d05e2a85bb80929621fbb076d4487f">qos_map_l2_eg_dft_profile</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> service_type)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;{</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <a class="code" href="structopennsl__qos__map__s.html" title="QoS Map structure.">opennsl_qos_map_t</a> l2_eg_map;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordtype">int</span> flags = 0;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordtype">int</span> idx = 0;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">/* Clear structure */</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  rv = <a class="code" href="group__qos.html#gacac84391e81a17e3931ff010edc16fbc" title="Allocates hardware resources for QoS mapping.">opennsl_qos_map_create</a>(unit, <a class="code" href="group__qos.html#gaca0749743282b2c8ecbbc2aad64ee143">OPENNSL_QOS_MAP_EGRESS</a>|<a class="code" href="group__qos.html#ga4ed7bc917da5208fbc5e5eedda72f58e">OPENNSL_QOS_MAP_L2_VLAN_PCP</a>, &amp;<a class="code" href="example__qos_8c.html#aa44e37fccfd9234fdeebc48c560cfece">qos_eg_map_id_dft</a>[service_type]);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    printf(<span class="stringliteral">&quot;error in egress PCP opennsl_qos_map_create() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">for</span> (idx=0; idx&lt;16; idx++) </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  {  </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="group__qos.html#gad16de3c9482ecdb12a094974e099679e" title="Initialize the QoS Map structure.">opennsl_qos_map_t_init</a>(&amp;l2_eg_map);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">/* Set ingress pkt_pri/cfi Priority */</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    l2_eg_map.<a class="code" href="structopennsl__qos__map__s.html#a176c4c022b72d74aee0005432e476003" title="Packet priority.">pkt_pri</a> = idx&gt;&gt;1;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    l2_eg_map.<a class="code" href="structopennsl__qos__map__s.html#aaf206499b42d591e3a98d840cd51f4e8" title="Packet CFI.">pkt_cfi</a> = idx&amp;1;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">/* Set internal priority for this ingress pri */</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    l2_eg_map.<a class="code" href="structopennsl__qos__map__s.html#a52a7ea7f2489ac1bbf4882ccb717b1e7" title="Internal priority.">int_pri</a> = idx&gt;&gt;1;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">/* Set color for this ingress Priority 0:opennslColorGreen 1:opennslColorYellow */</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    l2_eg_map.<a class="code" href="structopennsl__qos__map__s.html#a767735bce0217e4514f452355c4e1fd5" title="Color.">color</a> = idx&amp;1;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (service_type == <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72aa4aff4db03ef735c22eda0d745ec1336">match_untag</a>) </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      flags = <a class="code" href="group__qos.html#ga10a21d232a4a6beebcb9bf2b8d65a573">OPENNSL_QOS_MAP_L2</a>|<a class="code" href="group__qos.html#ga4ed7bc917da5208fbc5e5eedda72f58e">OPENNSL_QOS_MAP_L2_VLAN_PCP</a>|<a class="code" href="group__qos.html#gadb14eedbd8eae7a89cbac2d5c8234d07">OPENNSL_QOS_MAP_L2_UNTAGGED</a>|<a class="code" href="group__qos.html#gaca0749743282b2c8ecbbc2aad64ee143">OPENNSL_QOS_MAP_EGRESS</a>;        </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    } </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (service_type == <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72ac6b810c26f58e843de1254750b6840b8">match_otag</a>) </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      flags = <a class="code" href="group__qos.html#ga10a21d232a4a6beebcb9bf2b8d65a573">OPENNSL_QOS_MAP_L2</a>|<a class="code" href="group__qos.html#ga4ed7bc917da5208fbc5e5eedda72f58e">OPENNSL_QOS_MAP_L2_VLAN_PCP</a>|<a class="code" href="group__qos.html#ga630da06c619a1287c18e0a5128f919a0">OPENNSL_QOS_MAP_L2_OUTER_TAG</a>|<a class="code" href="group__qos.html#gaca0749743282b2c8ecbbc2aad64ee143">OPENNSL_QOS_MAP_EGRESS</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    rv = <a class="code" href="group__qos.html#gae5768c6ed5a320b404143298f4724b52" title="Add a specific mapping entry to a QoS map.">opennsl_qos_map_add</a>(unit, flags, &amp;l2_eg_map, <a class="code" href="example__qos_8c.html#aa44e37fccfd9234fdeebc48c560cfece">qos_eg_map_id_dft</a>[service_type]);    </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      printf(<span class="stringliteral">&quot;error in PCP egress opennsl_qos_map_add() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    }  </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">/* edit the eve action, map internal tc and dp to pkt_pri and pkt_cfi */</span></div>
<div class="line"><a name="l00261"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a2d4531e9c41943ae8e6268c4490291be">  261</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#a2d4531e9c41943ae8e6268c4490291be">initial_qos_service_vlan_action_set</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> service_type)</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;{</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <a class="code" href="structopennsl__vlan__port__s.html" title="Layer 2 Logical port type.">opennsl_vlan_port_t</a> *vlan_port = <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <a class="code" href="structopennsl__vlan__action__set__s.html" title="Initialize a VLAN tag action set structure.">opennsl_vlan_action_set_t</a> action;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <a class="code" href="group__vlan.html#gaed6082cf2b41282eeddaffec22668f28" title="Initialize a VLAN tag action set structure.">opennsl_vlan_action_set_t_init</a>(&amp;action);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">switch</span> (service_type)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72aa4aff4db03ef735c22eda0d745ec1336">match_untag</a>:</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;          <span class="comment">/* eve action for untagged service */</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;          action.<a class="code" href="structopennsl__vlan__action__set__s.html#ae02e6e5eddf1a00666b9ad2e0c8e01a7" title="Outer-tag action for untagged packets.">ut_outer</a> = <a class="code" href="group__types.html#ggadf0e38b647693b21df556fb5417b67e9a01a4c0d53f46abe28badcd882a31685e" title="Add VLAN tag.">opennslVlanActionAdd</a>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;          action.<a class="code" href="structopennsl__vlan__action__set__s.html#af0581476c7d3fdbc013c07239f032a74" title="New outer VLAN for Add/Replace actions.">new_outer_vlan</a> = <a class="code" href="example__qos_8c.html#a5be88c338e62fa10f68b2344cc53b7d6">down_ovlan1</a>;                </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;          action.<a class="code" href="structopennsl__vlan__action__set__s.html#a7e22ea274dee5752c3075e1a4ae44be5" title="Outer packet priority action for untagged packets.">ut_outer_pkt_prio</a> = <a class="code" href="group__types.html#ggadf0e38b647693b21df556fb5417b67e9a01a4c0d53f46abe28badcd882a31685e" title="Add VLAN tag.">opennslVlanActionAdd</a>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;          action.<a class="code" href="structopennsl__vlan__action__set__s.html#abf02e8ed6c077867433250f164ee8378" title="Internal or packet priority.">priority</a> = <a class="code" href="example__qos_8c.html#aa44e37fccfd9234fdeebc48c560cfece">qos_eg_map_id_dft</a>[service_type];</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;          vlan_port = &amp;<a class="code" href="example__qos_8c.html#aa308b122179ffb9bad17797b345d5e3c">out_vlan_port1</a>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72ac6b810c26f58e843de1254750b6840b8">match_otag</a>:</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          <span class="comment">/* eve action for tagged service */</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          action.<a class="code" href="structopennsl__vlan__action__set__s.html#af60ad1ada9311f4900ac4ce27a3b1a50" title="Outer-tag action for single-outer-tagged packets.">ot_outer</a> = <a class="code" href="group__types.html#ggadf0e38b647693b21df556fb5417b67e9ac8b1eadb80e4b018772b05cbf8bf87ef" title="Replace VLAN tag.">opennslVlanActionReplace</a>; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;          action.<a class="code" href="structopennsl__vlan__action__set__s.html#af0581476c7d3fdbc013c07239f032a74" title="New outer VLAN for Add/Replace actions.">new_outer_vlan</a> = <a class="code" href="example__qos_8c.html#aeea8641b678030d4ba20b5a9fc0ffef7">down_ovlan2</a>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          action.<a class="code" href="structopennsl__vlan__action__set__s.html#a8bd9731e2765f7006c9adacba4e4be8d" title="Outer packet priority action for single-outer-tagged packets.">ot_outer_pkt_prio</a> = <a class="code" href="group__types.html#ggadf0e38b647693b21df556fb5417b67e9ac8b1eadb80e4b018772b05cbf8bf87ef" title="Replace VLAN tag.">opennslVlanActionReplace</a>; <span class="comment">/* priority is set according to pcp_vlan_profile mapping */</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;          action.<a class="code" href="structopennsl__vlan__action__set__s.html#abf02e8ed6c077867433250f164ee8378" title="Internal or packet priority.">priority</a> = <a class="code" href="example__qos_8c.html#aa44e37fccfd9234fdeebc48c560cfece">qos_eg_map_id_dft</a>[<a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72aa4aff4db03ef735c22eda0d745ec1336">match_untag</a>];</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          vlan_port = &amp;<a class="code" href="example__qos_8c.html#a5e45f11b828c71c9c621bf12f9f0f37a">out_vlan_port2</a>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  rv = <a class="code" href="group__vlan.html#gaab0d27a54c226cc44499f21bbed0a2cc" title="Add an entry to the egress VLAN Translation table and assign VLAN actions.">opennsl_vlan_translate_egress_action_add</a>(unit, vlan_port-&gt;<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>, <a class="code" href="group__types.html#ga8d40a12f9f7c4d2ad3d2a07f296847fe">OPENNSL_VLAN_NONE</a>, <a class="code" href="group__types.html#ga8d40a12f9f7c4d2ad3d2a07f296847fe">OPENNSL_VLAN_NONE</a>, &amp;action);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    printf(<span class="stringliteral">&quot;error in eve translation opennsl_vlan_translate_egress_action_add() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">/* initialize the vlan port and set the default egress qos profile</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">   service model:  untag pkt -&gt; vid 200</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">                   vid 100 -&gt; vid 300 </span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="code" href="example__qos_8c.html#addcb57c9ee65d18f93545a731cd409c6">  305</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#addcb57c9ee65d18f93545a731cd409c6">initial_qos_service_init</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> port_in, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> port_out) </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;{</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">/* initialize the vlan ports */</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <a class="code" href="group__vlan.html#gaa1bf59398c66fd46c9109b4fc9d79051" title="Initialize the VLAN port structure.">opennsl_vlan_port_t_init</a>(&amp;in_vlan_port1);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  in_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#ab94d90776edeb955129f95b07f287181" title="Match criteria.">criteria</a> = <a class="code" href="group__vlan.html#ggac691cd787b4b6aa9a2f8b83659d4af50a7d650e49c2c32a113a26577834095d68" title="{Module, Port} or Trunk.">OPENNSL_VLAN_PORT_MATCH_PORT</a>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  in_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a38cc4cd1deb11194217fc3eed635b108" title="Gport: local or remote Physical or logical gport.">port</a> = port_in;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  in_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a7780aaa81891b515df40ae3696db218b" title="OPENNSL_VLAN_PORT_xxx.">flags</a> = (<a class="code" href="group__vlan.html#gacd3ff246480fbe6fe3623a5f315d187a" title="Preserve the outer VLAN tag (by default it is stripped).">OPENNSL_VLAN_PORT_OUTER_VLAN_PRESERVE</a> | <a class="code" href="group__vlan.html#ga2ca388882eeafa8c78514d8e00ba3a93" title="Preserve the inner VLAN tag (by default it is stripped).">OPENNSL_VLAN_PORT_INNER_VLAN_PRESERVE</a>);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <a class="code" href="group__vlan.html#gaa1bf59398c66fd46c9109b4fc9d79051" title="Initialize the VLAN port structure.">opennsl_vlan_port_t_init</a>(&amp;out_vlan_port1);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  out_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#ab94d90776edeb955129f95b07f287181" title="Match criteria.">criteria</a> = <a class="code" href="group__vlan.html#ggac691cd787b4b6aa9a2f8b83659d4af50a0e8e71613acf7f6159c59d446e5bb1d0" title="Mod/port/trunk + outer VLAN.">OPENNSL_VLAN_PORT_MATCH_PORT_VLAN</a>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  out_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a10ec33efb60f9917b243dd872dc3858f" title="Outer VLAN ID to match.">match_vlan</a> = <a class="code" href="example__qos_8c.html#a5be88c338e62fa10f68b2344cc53b7d6">down_ovlan1</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  out_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#aae4bfab581619f524b69104a589634bb" title="Egress Outer VLAN or SD-TAG VLAN ID.">egress_vlan</a> = <a class="code" href="example__qos_8c.html#a5be88c338e62fa10f68b2344cc53b7d6">down_ovlan1</a>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  out_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a38cc4cd1deb11194217fc3eed635b108" title="Gport: local or remote Physical or logical gport.">port</a> = port_out;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="group__vlan.html#gaa1bf59398c66fd46c9109b4fc9d79051" title="Initialize the VLAN port structure.">opennsl_vlan_port_t_init</a>(&amp;in_vlan_port2);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  in_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#ab94d90776edeb955129f95b07f287181" title="Match criteria.">criteria</a> = <a class="code" href="group__vlan.html#ggac691cd787b4b6aa9a2f8b83659d4af50a0e8e71613acf7f6159c59d446e5bb1d0" title="Mod/port/trunk + outer VLAN.">OPENNSL_VLAN_PORT_MATCH_PORT_VLAN</a>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  in_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a10ec33efb60f9917b243dd872dc3858f" title="Outer VLAN ID to match.">match_vlan</a> = <a class="code" href="example__qos_8c.html#a3dac63c8a5b5d1ccf667d0f7374ea64e">up_ovlan</a>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  in_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#aae4bfab581619f524b69104a589634bb" title="Egress Outer VLAN or SD-TAG VLAN ID.">egress_vlan</a> = <a class="code" href="example__qos_8c.html#a3dac63c8a5b5d1ccf667d0f7374ea64e">up_ovlan</a>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  in_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a38cc4cd1deb11194217fc3eed635b108" title="Gport: local or remote Physical or logical gport.">port</a> = port_in;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  in_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a7780aaa81891b515df40ae3696db218b" title="OPENNSL_VLAN_PORT_xxx.">flags</a> = (<a class="code" href="group__vlan.html#gacd3ff246480fbe6fe3623a5f315d187a" title="Preserve the outer VLAN tag (by default it is stripped).">OPENNSL_VLAN_PORT_OUTER_VLAN_PRESERVE</a> | <a class="code" href="group__vlan.html#ga2ca388882eeafa8c78514d8e00ba3a93" title="Preserve the inner VLAN tag (by default it is stripped).">OPENNSL_VLAN_PORT_INNER_VLAN_PRESERVE</a>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <a class="code" href="group__vlan.html#gaa1bf59398c66fd46c9109b4fc9d79051" title="Initialize the VLAN port structure.">opennsl_vlan_port_t_init</a>(&amp;out_vlan_port2);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  out_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#ab94d90776edeb955129f95b07f287181" title="Match criteria.">criteria</a> = <a class="code" href="group__vlan.html#ggac691cd787b4b6aa9a2f8b83659d4af50a0e8e71613acf7f6159c59d446e5bb1d0" title="Mod/port/trunk + outer VLAN.">OPENNSL_VLAN_PORT_MATCH_PORT_VLAN</a>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  out_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a10ec33efb60f9917b243dd872dc3858f" title="Outer VLAN ID to match.">match_vlan</a> = <a class="code" href="example__qos_8c.html#aeea8641b678030d4ba20b5a9fc0ffef7">down_ovlan2</a>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  out_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#aae4bfab581619f524b69104a589634bb" title="Egress Outer VLAN or SD-TAG VLAN ID.">egress_vlan</a> = <a class="code" href="example__qos_8c.html#aeea8641b678030d4ba20b5a9fc0ffef7">down_ovlan2</a>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  out_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a38cc4cd1deb11194217fc3eed635b108" title="Gport: local or remote Physical or logical gport.">port</a> = port_out;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">/* set port VLAN domain */</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  rv = <a class="code" href="group__port.html#gabe79179f76f375308b9a171f22905e32" title="Set or get port classification ID to aggregate a group of ports for further processing such as VLAN t...">opennsl_port_class_set</a>(unit, port_in, <a class="code" href="group__port.html#gga903dae8c0551492cc12715a9890175f3afd53eb54962612e34216b25545ae5fda" title="Class for mapping local-port to vlan-domain.">opennslPortClassId</a>, port_in);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    printf(<span class="stringliteral">&quot;error in opennsl_port_class_set() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  rv = <a class="code" href="group__port.html#gabe79179f76f375308b9a171f22905e32" title="Set or get port classification ID to aggregate a group of ports for further processing such as VLAN t...">opennsl_port_class_set</a>(unit, port_out, <a class="code" href="group__port.html#gga903dae8c0551492cc12715a9890175f3afd53eb54962612e34216b25545ae5fda" title="Class for mapping local-port to vlan-domain.">opennslPortClassId</a>, port_out);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    printf(<span class="stringliteral">&quot;error in opennsl_port_class_set() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="comment">/* create default egress qos profile */</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <a class="code" href="example__qos_8c.html#a82d05e2a85bb80929621fbb076d4487f">qos_map_l2_eg_dft_profile</a>(unit, <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72aa4aff4db03ef735c22eda0d745ec1336">match_untag</a>);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <a class="code" href="example__qos_8c.html#a82d05e2a85bb80929621fbb076d4487f">qos_map_l2_eg_dft_profile</a>(unit, <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72ac6b810c26f58e843de1254750b6840b8">match_otag</a>);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">* Set up tagged and untagged sercies, using port cross connect. </span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">*/</span> </div>
<div class="line"><a name="l00359"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a4f29952cd8470136b30a4e23338cdf72">  359</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#a4f29952cd8470136b30a4e23338cdf72">initial_qos_service</a>(<span class="keywordtype">int</span> unit)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;{</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> in_gport1, in_gport2, out_gport1, out_gport2;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  in_gport1 = 0;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  in_gport2 = 0;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  out_gport1 = 0;    </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  out_gport2 = 0;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="comment">/* create inLIF for untagged service */</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  rv = <a class="code" href="group__vlan.html#ga019a29bf98cbf78d0b609f3e1b00d473" title="Create a layer 2 logical port.">opennsl_vlan_port_create</a>(unit, &amp;in_vlan_port1);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    printf(<span class="stringliteral">&quot;lif_create failed! %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  in_gport1 = in_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  printf(<span class="stringliteral">&quot;%d\n&quot;</span>, in_gport1);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="comment">/* create inLIF for tagged service */</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  rv = <a class="code" href="group__vlan.html#ga019a29bf98cbf78d0b609f3e1b00d473" title="Create a layer 2 logical port.">opennsl_vlan_port_create</a>(unit, &amp;in_vlan_port2);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    printf(<span class="stringliteral">&quot;lif_create failed! %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  in_gport2 = in_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  printf(<span class="stringliteral">&quot;%d\n&quot;</span>, in_gport2);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">/* create outLIF for untagged service */</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  rv = <a class="code" href="group__vlan.html#ga019a29bf98cbf78d0b609f3e1b00d473" title="Create a layer 2 logical port.">opennsl_vlan_port_create</a>(unit, &amp;out_vlan_port1);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    printf(<span class="stringliteral">&quot;lif_create failed! %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  out_gport1 = out_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  printf(<span class="stringliteral">&quot;%d\n&quot;</span>, out_gport1);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">/* create outLIF for tagged service */</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  rv = <a class="code" href="group__vlan.html#ga019a29bf98cbf78d0b609f3e1b00d473" title="Create a layer 2 logical port.">opennsl_vlan_port_create</a>(unit, &amp;out_vlan_port2);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    printf(<span class="stringliteral">&quot;lif_create failed! %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  out_gport2 = out_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  printf(<span class="stringliteral">&quot;%d\n&quot;</span>, out_gport2);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="comment">/* add eve action for untagged service */</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <a class="code" href="example__qos_8c.html#a2d4531e9c41943ae8e6268c4490291be">initial_qos_service_vlan_action_set</a>(unit, <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72aa4aff4db03ef735c22eda0d745ec1336">match_untag</a>);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <a class="code" href="group__vswitch.html#ga340a3960bb4b9618ae5d861e4dd44e0f">opennsl_vswitch_cross_connect_t_init</a>(&amp;gports_untag);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  gports_untag.<a class="code" href="structopennsl__vswitch__cross__connect__s.html#aaba79634bfeef5834696a373bb28799c" title="First gport in cross connect.">port1</a> = in_gport1;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  gports_untag.<a class="code" href="structopennsl__vswitch__cross__connect__s.html#af243f2074c916a95c5bb10b3d6590822" title="Second gport in cross connect.">port2</a> = out_gport1;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="comment">/* cross connect two lifs for untagged service */</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  rv = <a class="code" href="group__vswitch.html#ga96551b13c0e1eec1550c2711058d9549" title="Attach two given logical ports in a point-to-point service.">opennsl_vswitch_cross_connect_add</a>(unit, &amp;gports_untag);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    printf(<span class="stringliteral">&quot;error in opennsl_vswitch_cross_connect_add() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">/* add eve action for tagged service */</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <a class="code" href="example__qos_8c.html#a2d4531e9c41943ae8e6268c4490291be">initial_qos_service_vlan_action_set</a>(unit, <a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72ac6b810c26f58e843de1254750b6840b8">match_otag</a>);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <a class="code" href="group__vswitch.html#ga340a3960bb4b9618ae5d861e4dd44e0f">opennsl_vswitch_cross_connect_t_init</a>(&amp;gports_tag);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  gports_tag.<a class="code" href="structopennsl__vswitch__cross__connect__s.html#aaba79634bfeef5834696a373bb28799c" title="First gport in cross connect.">port1</a> = in_gport2;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  gports_tag.<a class="code" href="structopennsl__vswitch__cross__connect__s.html#af243f2074c916a95c5bb10b3d6590822" title="Second gport in cross connect.">port2</a> = out_gport2;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="comment">/* cross connect two lifs for tagged service */</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  rv = <a class="code" href="group__vswitch.html#ga96551b13c0e1eec1550c2711058d9549" title="Attach two given logical ports in a point-to-point service.">opennsl_vswitch_cross_connect_add</a>(unit, &amp;gports_tag);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    printf(<span class="stringliteral">&quot;error in opennsl_vswitch_cross_connect_add() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;}</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">* clean tagged and untagged sercies </span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="code" href="example__qos_8c.html#ad19f0c25a5eb037661f6b66c58c82fbc">  444</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__qos_8c.html#ad19f0c25a5eb037661f6b66c58c82fbc">initial_qos_service_cleanup</a>(<span class="keywordtype">int</span> unit)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  gports_untag.<a class="code" href="structopennsl__vswitch__cross__connect__s.html#aaba79634bfeef5834696a373bb28799c" title="First gport in cross connect.">port1</a> = in_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  gports_untag.<a class="code" href="structopennsl__vswitch__cross__connect__s.html#af243f2074c916a95c5bb10b3d6590822" title="Second gport in cross connect.">port2</a> = out_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  gports_tag.<a class="code" href="structopennsl__vswitch__cross__connect__s.html#aaba79634bfeef5834696a373bb28799c" title="First gport in cross connect.">port1</a> = in_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  gports_tag.<a class="code" href="structopennsl__vswitch__cross__connect__s.html#af243f2074c916a95c5bb10b3d6590822" title="Second gport in cross connect.">port2</a> = out_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">/* Delete the cross connected LIFs for untagged service */</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  rv = <a class="code" href="group__vswitch.html#gac7f6918f99f69f696f370d0550bb6790" title="Remove attachment between the given logical ports.">opennsl_vswitch_cross_connect_delete</a>(unit, &amp;gports_untag);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    printf(<span class="stringliteral">&quot;Error, opennsl_vswitch_cross_connect_delete() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">/* Delete the cross connected LIFs for tagged service */</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  rv = <a class="code" href="group__vswitch.html#gac7f6918f99f69f696f370d0550bb6790" title="Remove attachment between the given logical ports.">opennsl_vswitch_cross_connect_delete</a>(unit, &amp;gports_tag);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    printf(<span class="stringliteral">&quot;Error, opennsl_vswitch_cross_connect_delete() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="comment">/* Delete inLIF for untagged service */</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  rv = <a class="code" href="group__vlan.html#gae4efeb6b6831a2640284bb31a07bb832" title="Destroy a layer 2 logical port.">opennsl_vlan_port_destroy</a>(unit, in_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    printf(<span class="stringliteral">&quot;Error, opennsl_vlan_port_destroy() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="comment">/* Delete outLIF for untagged service */</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  rv = <a class="code" href="group__vlan.html#gae4efeb6b6831a2640284bb31a07bb832" title="Destroy a layer 2 logical port.">opennsl_vlan_port_destroy</a>(unit, out_vlan_port1.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    printf(<span class="stringliteral">&quot;Error, opennsl_vlan_port_destroy() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">/* Delete inLIF for tagged service */</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  rv = <a class="code" href="group__vlan.html#gae4efeb6b6831a2640284bb31a07bb832" title="Destroy a layer 2 logical port.">opennsl_vlan_port_destroy</a>(unit, in_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    printf(<span class="stringliteral">&quot;Error, opennsl_vlan_port_destroy() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="comment">/* Delete outLIF for tagged service*/</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  rv = <a class="code" href="group__vlan.html#gae4efeb6b6831a2640284bb31a07bb832" title="Destroy a layer 2 logical port.">opennsl_vlan_port_destroy</a>(unit, out_vlan_port2.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    printf(<span class="stringliteral">&quot;Error, opennsl_vlan_port_destroy() $rv\n&quot;</span>);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="comment">/* destroy the qos profile */</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <a class="code" href="group__qos.html#ga413e488c7b88957e32e572ef110f0d71" title="Frees hardware resources for QoS mapping.">opennsl_qos_map_destroy</a>(unit, <a class="code" href="example__qos_8c.html#aa44e37fccfd9234fdeebc48c560cfece">qos_eg_map_id_dft</a>[<a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72aa4aff4db03ef735c22eda0d745ec1336">match_untag</a>]);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <a class="code" href="group__qos.html#ga413e488c7b88957e32e572ef110f0d71" title="Frees hardware resources for QoS mapping.">opennsl_qos_map_destroy</a>(unit, <a class="code" href="example__qos_8c.html#aa44e37fccfd9234fdeebc48c560cfece">qos_eg_map_id_dft</a>[<a class="code" href="example__qos_8c.html#a530725d62a88974caaa9b1c91080db72ac6b810c26f58e843de1254750b6840b8">match_otag</a>]);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keywordflow">return</span> rv;        </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;}</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00518"></a><span class="lineno"><a class="code" href="example__qos_8c.html#a0ddf1224851353fc92bfbff6f499fa97">  518</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for policer application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;{</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordtype">int</span> rv = 0;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordtype">int</span> unit = <a class="code" href="example__qos_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordtype">int</span> choice;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordtype">int</span> inport, outport, use_de;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">if</span>((argc != 1) || ((argc &gt; 1) &amp;&amp; (strcmp(argv[1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">/* Initialize the system. */</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system. Error: %s\r\n&quot;</span>,</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;           <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="comment">/* cold boot initialization commands */</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rc = %d (%s).\r\n&quot;</span>,</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;           rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">/* Add ports to default vlan. */</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  printf(<span class="stringliteral">&quot;Adding ports to default vlan.\r\n&quot;</span>);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  rv = <a class="code" href="examples_2util_8h.html#a2d14e4de1f4a7192ac7e378f8f7c63ff" title="Add all ports to default vlan.">example_switch_default_vlan_config</a>(unit);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    printf(<span class="stringliteral">&quot;\r\nFailed to add default ports. Error: %s\r\n&quot;</span>,</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    printf(<span class="stringliteral">&quot;1. Create QoS mapping\n&quot;</span>);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application.\r\n&quot;</span>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">switch</span>(choice)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        printf(<span class="stringliteral">&quot;Enter the input port number(belonging to core-0):\n&quot;</span>);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;inport) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          printf(<span class="stringliteral">&quot;Invalid value entered. Please re-enter.\n&quot;</span>);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        printf(<span class="stringliteral">&quot;Enter the output port number(belonging to core-0):\n&quot;</span>);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;outport) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;          printf(<span class="stringliteral">&quot;Invalid value entered. Please re-enter.\n&quot;</span>);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        printf(<span class="stringliteral">&quot;Enter whether to use DEI for QoS mapping(0/1):\n&quot;</span>);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordflow">if</span>((<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;use_de) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) ||</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;           ((use_de != 0) &amp;&amp; (use_de != 1)))</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;          printf(<span class="stringliteral">&quot;Invalid value entered. Please re-enter.\n&quot;</span>);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        rv = <a class="code" href="example__qos_8c.html#addcb57c9ee65d18f93545a731cd409c6">initial_qos_service_init</a>(unit, inport, outport); </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          printf(<span class="stringliteral">&quot;\r\nFailed to initialize the QoS service. Error: %s\r\n&quot;</span>,</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;             <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  }  </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        rv = <a class="code" href="example__qos_8c.html#a4f29952cd8470136b30a4e23338cdf72">initial_qos_service</a>(unit); </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          printf(<span class="stringliteral">&quot;\r\nFailed to start the initial QoS service. Error: %s\r\n&quot;</span>,</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;              <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }  </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        rv = <a class="code" href="example__qos_8c.html#ae31c8867a38c33e793aff85a3c8a7627">qos_pcp_map_create</a>(unit, inport, use_de);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;          printf(<span class="stringliteral">&quot;\r\nFailed to create the QoS PCP mapping. Error: %s\r\n&quot;</span>,</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;              <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        }  </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        opennsl_driver_shell();</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        rv = <a class="code" href="driver_8h.html#aa760e8f1af45c7fd27ec014b82c572f2" title="Function to free up the resources and exit the driver.">opennsl_driver_exit</a>();</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    } <span class="comment">/* End of switch */</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  } <span class="comment">/* End of while */</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;}</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016-17 by Broadcom Limited. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Limited reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Limited is believed to be accurate and reliable. However, Broadcom Limited does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
</div>
<!--END GENERATE_TREEVIEW-->
</body>
</html>
